---
import client from "../../tina/__generated__/client";

const resp = await client.queries.projectConnection();
const projectContent = (resp.data.projectConnection?.edges ?? [])
  .map((e) => {
    const node = e?.node;
    if (!node) return null;
    return {
      title: node.title,
      description: node.description,
      stack: node.stack ?? [],
      link: node.link,
      slug: `/projects/${node._sys.filename}`,
    };
  })
  .filter((n): n is NonNullable<typeof n> => n !== null);

// Format date helper
const formatDate = () => {
  const now = new Date();
  return now.toLocaleDateString("en-US", { month: "short", day: "numeric" });
};
---

{
  projectContent.map(({ title, description, stack, link, slug }) => (
    <a
      href={slug}
      class="tweet-card"
      style="text-decoration: none; color: inherit; display: block;"
    >
      <div class="tweet-card-header">
        <img src="/user-profile.jpg" alt="Avatar" class="tweet-avatar" />
        <div class="tweet-content">
          <div class="tweet-author-row">
            <span class="tweet-author-name">Nanda Kresnatara</span>
            <span class="tweet-author-handle">@taradevio</span>
            <span class="tweet-date">{formatDate()}</span>
          </div>

          <div class="tweet-text">
            <div class="tweet-title">{title}</div>
            {description}
          </div>

          <div class="tweet-tags">
            {stack.map((item) => (
              <span class="tweet-tag">{item}</span>
            ))}
          </div>
        </div>
      </div>
    </a>
  ))
}
