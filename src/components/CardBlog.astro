---
import client from "../../tina/__generated__/client";

const resp = await client.queries.postConnection();
const posts = (resp.data.postConnection?.edges ?? [])
  .map((e) => e?.node ?? null)
  .filter((n): n is NonNullable<typeof n> => n !== null);

// kalau kamu pakai subfolder di content/blog, pakai breadcrumbs:
const toSlug = (n: (typeof posts)[number]) =>
  n._sys.breadcrumbs?.length ? n._sys.breadcrumbs.join("/") : n._sys.filename;
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
  {
    posts.map((p) => {
      const slug = toSlug(p);
      return (
        <div class="">
          {p.image && (
            <img
              src={p.image}
              alt={p.alt ?? p.title}
              class="w-full aspect-square lg:aspect-video object-cover rounded"
            />
          )}
          <h2 class="text-2xl pt-3 font-semibold">{p.title}</h2>
          <p class="truncate italic font-light">{p.description}</p>
          {p.date && (
            <time class="text-sm block text-right font-semibold my-2">
              {new Date(p.date).toLocaleDateString()}
            </time>
          )}
          <a href={`/blog/${slug}`} class="block">
            <button class="w-full py-2 rounded-sm border-1 hover:shadow cursor-pointer block font-bold">
              Read More
            </button>
          </a>
        </div>
      );
    })
  }
</div>
